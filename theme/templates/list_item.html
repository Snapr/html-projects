<div class="aj-container">

<% if(item.get('status') == 'moderated'){ %>
    <p class="text-muted center">Image not found</p>
<% }else{ %>

  <div class="coordinates">

    <% if(item.has('location') && item.get('location').location){ %>
       
       <a class="ui-icon-location"></a>
        <a class="x-goto-map s-location">
           <%= string_utils.short_location(item.get('location').location) %>
        </a>
    <% }%>
    <a href="#" class="s-time"><%= string_utils.short_timestamp(item.get('date'), true ) %></a>

    <% if(new_image) { %>
    <div class="aj-new"><span class="ui-icon-bookmark"></span> <i>New</i> item</div>
    <% } %>

    <div class="haveTaken"><%= have_taken %></div>
</div>

<div class="s-image-area">
    <img style="height:<%= obj.height %>px;" src="https://s3.amazonaws.com/media-server<%= item.get('server_id') %>.snapr.us/lrg/<%= item.get('secret') %>/<%= item.get('id') %>.jpg" <% if(item.get('description')){ %>alt="<%= item.get('description') %>"<% } %> class="x-photo s-photo" />
</div>

<div class="s-image-details">

    <div class="s-description"><%= string_utils.comment_links( item.get('caption') ) %>

          <%
             if (item.get("username") && item.get("username").toLowerCase() == (auth.get("snapr_user") || "").toLowerCase()){ %>
            
            <div class="tags-readable owner">

          <% }else { %>

            <div class="tags-readable">

          <% } %>


              <%     
              _.each(item.get('materials') , function(mat) { %>
                <a href="#/photos/?tag=<%= mat %>" data-role="button" data-inline="true" data-mini="true" ><%= mat %></a>
               <% }); %>

               <%
                  if (item.get("username") && item.get("username").toLowerCase() == (auth.get("snapr_user") || "").toLowerCase()){ %>
                 
                 <a data-role="button" data-inline="true" data-mini="true" data-icon='edit'>Edit</a>

               <% }  %>

            </div>

            <div class="tags-editable owner">
              <span>
              <%     
              _.each(item.get('materials') , function(mat) { %>
                <a data-role="button" data-inline="true" data-mini="true" data-icon="remove" class="deleteable"><%= mat %></a>
               <% }); %>
               </span>
               <a data-role="button" data-rel="popup" href="#aj-add-tag-<%= item.cid %>" data-inline="true" data-mini="true" data-icon="plus" class="addTag-pop">Add</a>

            </div>

        <% if (item.has('location') && item.get('location').spot_id){%>
        <a class="s-spot x-goto-spot">
            @ <%= item.get('location').foursquare_venue_name %>
        </a>
        <%}%>
        <% if(config.get('app_group') == 'snapr' && item.has('app') && item.get('app').slug !== 'snapr'){ %>
            &mdash; via <a href="http://apps.sna.pr/<%= item.get('app').slug %>/" target="blank"><%= item.get('app').name %></a>
        <% }%>

    </div>

 	<% if(item.get('rating') >= 2){ %>
    <p class="s-featured s-icon-left"><span class="ui-icon ui-icon-star-empty"></span> <%= T('Featured', {context:"shout"}) %></p>
	<% } %>

    <ul class="x-comments s-comments">
        <% _.each(item.get('latest_comments'), function(comment){ %>
            <li><a><%= comment.user %></a> <%= string_utils.comment_links( comment.comment ) %></li>
        <% }) %>
        <% if(item.get('comments') > 10){ %><li><a class="x-show-comments"><%= T('Show more comments') %></a></li><% } %>
    </ul>

    <div class="s-action-buttons x-action-buttons">

        <!-- Comment button -->
        <a data-role="button" data-theme="b" data-inline="true" data-icon="comments" data-iconpos="notext" class="x-comment-button large-icon">Comment</a>

        <!-- Share button -->
        <a data-role="button" data-theme="b" data-inline="true" data-icon="share-alt" data-iconpos="notext" class="x-share-button large-icon">Share</a>

        <!-- More button -->
        <% if (item.get("username") == auth.get("snapr_user") || config.get('moderation_controls')){ %>
            <a data-rel="popup" href="#more-menu-<%= item.cid %>" data-role="button" data-theme="b" data-icon="large-more" data-inline="true" data-iconpos="notext" class="x-more-button s-more-button large-icon">More</a>

        <% } %>
    </div>

    <!-- reactions -->
    <div data-role="popup" class="x-reactions s-popup" data-theme="a" data-overlay-theme="b">
        <div class="x-header ui-header"></div>
        <ul class="x-list s-reactions-list" data-role="listview"></ul>
    </div>

    <!-- More menu -->
    <div data-role="popup" class="x-more-menu s-more-menu" data-theme="a" id="more-menu-<%= item.cid %>" data-dismissible="true">
            <a class="aj-take" data-role="button" data-theme="c">
               Report Taken
           </a>
            <a class="aj-untake" data-role="button" data-theme="c">
               Report Not Taken
           </a>
            <a class="aj-email" data-role="button" data-theme="c">
               Email this item
           </a>
           
        <% if (item.get("username") && item.get("username").toLowerCase() == (auth.get("snapr_user") || "").toLowerCase()){ %>
            <a class="x-delete" data-role="button" data-theme="c">
               Delete
           </a>
        <%} else if(config.get('moderation_controls')){ %>
            <a class="x-flag" data-role="button" data-theme="c">
                <% if (item.get('flagged')){%> flagged <% }else{ %> Flag inappropriate <% } %>
            </a>
        <%}%>
    </div>

</div>

<div class="s-comment-area x-comment-form hide">
   <form action="javascript:void(0);" accept-charset="utf-8" >
       <textarea name="comment-<%= item.get('id') %>" placeholder="<%= T('Type your message') %>" class="s-comment" data-theme="a"/>

       <div class="ui-grid-a">
           <div class="ui-block-a"></div>
           <div class="ui-block-b">
               <button class="x-submit-button" data-theme="e"><%= T('Comment') %></button>
           </div>
       </div>
   </form>
</div>

<% } %>

<div class="afterImg"></div>

</div><!-- aj-container-->

<!-- share form -->
<div class="s-share-area x-share-menu hide">

    <form action="javascript:void(0);" accept-charset="utf-8">
        <div class="s-message-area">
            <textarea data-theme="a" name="comment-<%= item.get('id') %>" placeholder="<%= T('Type a message') %> " class="s-photo-share-comment"></textarea>
            <% if (item.get("username") != auth.get("snapr_user")){ %><span class="s-shared-via"> &mdash; via <span class="s-username">@<%= item.get("username") %></span></span><br><% } %>
        </div>

        <fieldset data-role="controlgroup" data-type="<%=config.get('services_list')%>" class="s-image-sharing">
            
            <% if(_.contains(config.get('services'), 'twitter')){ %>
                <input type="checkbox" class="x-service-select" name="twitter" id="twitter-sharing" <% if(share_settings.twitter){ %>checked="checked"<% } %>/>
                <label for="twitter-sharing">
                    <span class="ui-icon ui-icon-social-twitter"></span>
                    <span class="s-service-text">Twitter</span>
                </label>
            <% } %>

            <% if(_.contains(config.get('services'), 'facebook')){ %>
                <input type="checkbox" class="x-service-select" name="facebook_album" id="facebook-sharing" <% if(share_settings.facebook_album){ %>checked="checked"<% } %>/>
                <label for="facebook-sharing">
                    <span class="ui-icon ui-icon-social-facebook"></span>
                    <span class="s-service-text">Facebook</span>
                </label>
            <% } %>

            <% if(_.contains(config.get('services'), 'tumblr')){ %>
                <input type="checkbox" class="x-service-select" name="tumblr" id="tumblr-sharing" <% if(share_settings.tumblr){ %>checked="checked"<% } %>/>
                <label for="tumblr-sharing">
                    <span class="ui-icon ui-icon-social-tumblr"></span>
                    <span class="s-service-text">Tumblr</span>
                </label>
            <% } %>
           
        </fieldset>

        <div class="ui-grid-a">
            <div class="ui-block-a"></div>
            <div class="ui-block-b">
                <button class="x-submit-button" data-theme="e"><%= T('Share') %></button>
            </div>
        </div>

    </form>
    <div class="x-success hide s-warning-message">Thanks! The photo has been shared</div>
</div>

<!-- Add tag menu -->
<div data-role="popup" class="aj-add-tag" data-theme="a" id="aj-add-tag-<%= item.cid %>" data-dismissible="true">
  <h5>Please insert your own tag</h5>
  <form id="addTag" action="javascript:void(0);" accept-charset="utf-8" >
      <input name="newTag-<%= item.get('id') %>" placeholder="<%= T('Add Tags') %>" class="aj-newTags" data-theme="a"/>
      

      <div class="ui-grid-a">
          <div class="ui-block-a">
            <button type="button"class="clearTag-button" data-theme="g"><%= T('Clear') %></button>
          </div>
          <div class="ui-block-b">
              <button type="button"class="addTag-button" data-theme="g"><%= T('Add') %></button>
          </div>
      </div>

      <input type="submit" value="Submit" data-role="none" />
  </form>

</div>

